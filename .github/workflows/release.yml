name: maven-release-ci

on:
  push:
    tags: [ "v*" ]
    paths-ignore:
      - '**.md'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
      uses: actions/checkout@v4

    - name: Set up JDK 1.17
      uses: actions/setup-java@v1
      with:
        java-version: 1.17

    - name: Build with Maven
      run: mvn package

    - name: Set variables
      id: vars
      run: echo ::set-output name=version::${GITHUB_REF#refs/tags/*}

    - uses: marvinpinto/action-automatic-releases@latest
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        automatic_release_tag: "${{ steps.vars.outputs.version }}"
        prerelease: false
        title: "PetTeleport ${{ steps.vars.outputs.version }}"
        files: |
          target/(.jar|!(original-PetTeleport.jar))

#    - name: Discord Notification
#      env:
#        DISCORD_WEBHOOK: ${{ secrets.RELEASE_WEBHOOK }}
#      uses: Ilshidur/action-discord@master
#      with:
#        args: |
#          **New release for** `{{ EVENT_PAYLOAD.repository.full_name }}`: **Version:** ${{ steps.vars.outputs.version }}
#          ```${{github.event.release.body}}```
#          Direct download: ${{steps.automatic_release.outputs.browser_download_url}}
